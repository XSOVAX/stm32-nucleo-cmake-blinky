# STM32F103RB CMSIS + FreeRTOS Blinky Project

> –ú–∏–≥–∞–Ω–∏–µ —Å–≤–µ—Ç–æ–¥–∏–æ–¥–æ–º –Ω–∞ –ø–ª–∞—Ç–µ Nucleo-F103RB (STM32F103RB) —á–µ—Ä–µ–∑ PA5  
> –°–±–æ—Ä–∫–∞: CMake + GNU Arm Embedded Toolchain  
> –ü—Ä–æ—à–∏–≤–∫–∞: `st-flash` –∏–ª–∏ OpenOCD —á–µ—Ä–µ–∑ ST-Link  
> RTOS: FreeRTOS V10.5.1 ‚Äî —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –æ—Ç–ª–∞–¥–∫–∏ –≤ VSCode (RTOS View)  
> –ü–æ–¥–¥–µ—Ä–∂–∫–∞: Linux (Manjaro, Ubuntu), macOS

---

## üì¶ –î–µ—Ä–µ–≤–æ –ø—Ä–æ–µ–∫—Ç–∞
```bash
stm32-nucleo-cmake-blinky/
‚îú‚îÄ‚îÄ README.md                  ‚Üê üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ build_and_flash.sh         ‚Üê üöÄ –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç: —Å–æ–±—Ä–∞—Ç—å + –ø—Ä–æ—à–∏—Ç—å
‚îú‚îÄ‚îÄ rebuild.sh                 ‚Üê üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç: —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞
‚îú‚îÄ‚îÄ CMakeLists.txt             ‚Üê üß± –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª —Å–±–æ—Ä–∫–∏
‚îú‚îÄ‚îÄ arm-gcc.cmake              ‚Üê ‚öôÔ∏è Toolchain –¥–ª—è –∫—Ä–æ—Å—Å-–∫–æ–º–ø–∏–ª—è—Ü–∏–∏
‚îú‚îÄ‚îÄ ld/
‚îÇ   ‚îî‚îÄ‚îÄ STM32F103RB_FLASH.ld   ‚Üê üìç –õ–∏–Ω–∫–µ—Ä-—Å–∫—Ä–∏–ø—Ç
‚îú‚îÄ‚îÄ cmsis/                     ‚Üê üì¶ CMSIS –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ core_cm3.h
‚îÇ   ‚îú‚îÄ‚îÄ stm32f103xb.h
‚îÇ   ‚îú‚îÄ‚îÄ system_stm32f1xx.c
‚îÇ   ‚îú‚îÄ‚îÄ system_stm32f1xx.h
‚îÇ   ‚îî‚îÄ‚îÄ startup_stm32f103xb.s
‚îú‚îÄ‚îÄ FreeRTOS/                  # –Ø–¥—Ä–æ FreeRTOS v10.5.1
‚îÇ   ‚îú‚îÄ‚îÄ croutine.c
‚îÇ   ‚îú‚îÄ‚îÄ event_groups.c
‚îÇ   ‚îú‚îÄ‚îÄ include/
‚îÇ   ‚îú‚îÄ‚îÄ list.c
‚îÇ   ‚îú‚îÄ‚îÄ portable/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GCC/ARM_CM3/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ MemMang/
‚îÇ   ‚îú‚îÄ‚îÄ queue.c
‚îÇ   ‚îú‚îÄ‚îÄ stream_buffer.c
‚îÇ   ‚îú‚îÄ‚îÄ tasks.c
‚îÇ   ‚îî‚îÄ‚îÄ timers.c
‚îú‚îÄ‚îÄ main.c                 # –ö–æ–¥: –º–∏–≥–∞–Ω–∏–µ —á–µ—Ä–µ–∑ FreeRTOS –∑–∞–¥–∞—á—É
‚îî‚îÄ‚îÄ memcpy.c               # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è memcpy/memset –¥–ª—è FreeRTOS
```
---

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –û—Ç–∫—É–¥–∞ –≤–∑—è–ª—Å—è |
|----------|------------|----------------|
| **CMSIS** | –°—Ç–∞–Ω–¥–∞—Ä—Ç ARM –¥–ª—è Cortex-M ‚Äî –∑–∞–≥–æ–ª–æ–≤–∫–∏, startup, —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ | [ARM-software/CMSIS_5](https://github.com/ARM-software/CMSIS_5) (–≤—Ä—É—á–Ω—É—é —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã) |
| **FreeRTOS** | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä —Ñ–∞–π–ª–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç RTOS, —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –∏ –∏—Ö –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è | –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ FreeRTOS |
| **startup_stm32f103xb.s** | –í–µ–∫—Ç–æ—Ä –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–µ–∫–∞, –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ `main` | –í–∑—è—Ç –∏–∑ –ø—Ä–∏–º–µ—Ä–æ–≤ ST / CMSIS, –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ–¥ bare-metal |
| **system_stm32f1xx.c** | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `SystemInit()` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ 72 –ú–ì—Ü | CMSIS, –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –æ—Ç ST |
| **STM32F103RB_FLASH.ld** | –õ–∏–Ω–∫–µ—Ä-—Å–∫—Ä–∏–ø—Ç ‚Äî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ (Flash 128K, RAM 20K) | –ù–∞–ø–∏—Å–∞–Ω –≤—Ä—É—á–Ω—É—é –Ω–∞ –æ—Å–Ω–æ–≤–µ Reference Manual |
| **CMakeLists.txt** | –û–ø–∏—Å–∞–Ω–∏–µ —Å–±–æ—Ä–∫–∏ ‚Äî —Ü–µ–ª–∏, —Ñ–ª–∞–≥–∏, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ | –ù–∞–ø–∏—Å–∞–Ω —Å –Ω—É–ª—è, –∑–∞—Ç–æ—á–µ–Ω –ø–æ–¥ embedded |
| **arm-gcc.cmake** | Toolchain —Ñ–∞–π–ª ‚Äî —É–∫–∞–∑—ã–≤–∞–µ—Ç CMake –Ω–∞ –∫—Ä–æ—Å—Å-–∫–æ–º–ø–∏–ª—è—Ç–æ—Ä | –ù–∞–ø–∏—Å–∞–Ω –≤—Ä—É—á–Ω—É—é |
| **build_and_flash.sh** | –ì–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç ‚Äî –æ—á–∏—Å—Ç–∫–∞, —Å–±–æ—Ä–∫–∞, –ø—Ä–æ—à–∏–≤–∫–∞ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π | –ù–∞–ø–∏—Å–∞–Ω –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É–ø—Ä–æ—â–µ–Ω–∏—è |
| **rebuild.sh** | –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç ‚Äî —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ (–±–µ–∑ –ø—Ä–æ—à–∏–≤–∫–∏) | –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ |

---

## üß© –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —Å–∫—Ä–∏–ø—Ç—ã

### 1. `build_and_flash.sh`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**

- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ `arm-none-eabi-gcc` –∏ `st-flash`
- ‚úÖ –£–¥–∞–ª—è–µ—Ç –ø–∞–ø–∫—É `build/`
- ‚úÖ –°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é `build/` –∏ –∑–∞—Ö–æ–¥–∏—Ç –≤ –Ω–µ—ë
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç `cmake` —Å —Ç—É–ª—á–µ–π–Ω–æ–º
- ‚úÖ –°–æ–±–∏—Ä–∞–µ—Ç `.bin` —Ñ–∞–π–ª
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ ST-Link (`st-info --probe`)
- ‚úÖ –ü—Ä–æ—à–∏–≤–∞–µ—Ç `.bin` –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —á–µ—Ä–µ–∑ `st-flash`
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –ø—Ä–æ—à–∏–≤–∫–∏

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**

```bash
chmod +x build_and_flash.sh  # –¥–µ–ª–∞–µ–º —Ñ–∞–π–ª –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
./build_and_flash.sh         # –≤—Å–µ–≥–¥–∞, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –∏ –ø—Ä–æ—à–∏—Ç—å
```

**–ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã:**

- **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω arm-none-eabi-gcc** ‚Üí –¥–ª—è —Å–±–æ—Ä–∫–∏
- **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω stlink** ‚Üí –¥–ª—è –ø—Ä–æ—à–∏–≤–∫–∏
- **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã make, cmake** ‚Üí –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ —Å–±–æ—Ä–∫–∏
- **–ü–ª–∞—Ç–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ —á–µ—Ä–µ–∑ USB** (ST-Link)
     

### 1. 'rebuild.sh'

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**

- ‚úÖ –£–¥–∞–ª—è–µ—Ç –ø–∞–ø–∫—É build/
- ‚úÖ –°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é build/
- ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç cmake
- ‚úÖ –°–æ–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç (.elf, .bin, .hex)
     

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**

```bash
 chmod +x rebuild.sh        # –¥–µ–ª–∞–µ–º —Ñ–∞–π–ª –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
./rebuild.sh                # –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
 ```
 

**–ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã:**


- **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω arm-none-eabi-gcc** ‚Üí –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
- **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω make** ‚Üí –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ (CMake –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç Makefile)
- **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω cmake** ‚Üí –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
     

*** üí° –í–ê–ñ–ù–û: rebuild.sh –Ω–µ –ø—Ä–æ—à–∏–≤–∞–µ—Ç –ø–ª–∞—Ç—É ‚Äî –æ–Ω —Ç–æ–ª—å–∫–æ —Å–æ–±–∏—Ä–∞–µ—Ç.***
***    –ß—Ç–æ–±—ã –∑–∞–ª–∏—Ç—å –ø—Ä–æ—à–∏–≤–∫—É ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π build_and_flash.sh –∏–ª–∏ make flash –≤–Ω—É—Ç—Ä–∏ build/. ***
     

 
## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (Manjaro Linux)

**–î–ª—è –æ–±–æ–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ –Ω—É–∂–Ω—ã:**
```bash
sudo pacman -S arm-none-eabi-gcc arm-none-eabi-newlib make cmake
```

**–î–ª—è build_and_flash.sh –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:**
```bash
sudo pacman -S stlink
```


## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª (—Å–±–æ—Ä–∫–∞ + –ø—Ä–æ—à–∏–≤–∫–∞)**
```bash
git clone <—Ç–≤–æ–π-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π>
cd stm32-nucleo-cmake-blinky
chmod +x build_and_flash.sh
./build_and_flash.sh
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –¢–æ–ª—å–∫–æ —Å–±–æ—Ä–∫–∞ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏, –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞)**
```bash
git clone <—Ç–≤–æ–π-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π>
cd stm32-nucleo-cmake-blinky
chmod +x rebuild.sh
./rebuild.sh
cd build
make flash
```


## üìö –ò—Å—Ç–æ—á–Ω–∏–∫–∏
- CMSIS: https://github.com/ARM-software/CMSIS_5 
- STM32F1 Reference Manual: RM0008
- GNU Arm Embedded Toolchain: https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain 
- stlink: https://github.com/stlink-org/stlink 
- FreeRTOS: https://www.freertos.org
     
